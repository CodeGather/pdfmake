<!doctype html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="Generator" content="EditPlus®">
	<meta name="Author" content="">
	<meta name="Keywords" content="">
	<meta name="Description" content="">
	<title>PDF生成并下载</title>
	<script src="https://cdn.bootcss.com/jquery/1.12.1/jquery.min.js"></script>
	<script src='./build/pdfmake.min.js'></script>
	<script src='./build/vfs_fonts.js'></script>
</head>

<body>
	<button class="open">预览PDF</button>
	<button class="download">下载PDF</button>
</body>
<script>
	function ImageDataURL(urls) { //urls必須是字符串或字符串數組
		this.totalnum = 0;
		this.imgdata = new Array();
		this.emptyobj = new Object();
		this.oncomplete = function () {};
		this.getDataURL = function (url, index) {
			var c = document.createElement("canvas");
			var ctx = c.getContext("2d");
			var img = new Image();
			var p = this;
			img.src = url;
			img.setAttribute('crossOrigin', 'anonymous');
			img.onload = function () {
				var i;
				var maxwidth = 500;
				var scale = 1.0;
				if (img.width > maxwidth) {
					scale = maxwidth / img.width;
					c.width = maxwidth;
					c.height = Math.floor(img.height * scale);
				} else {
					c.width = img.width;
					c.height = img.height;
				}
				ctx.drawImage(img, 0, 0, c.width, c.height);

				p.imgdata[index] = c.toDataURL('image/jpeg', 1);
				for (i = 0; i < p.totalnum; ++i) {
					if (p.imgdata[i] == null) break;
				}
				if (i == p.totalnum) {
					p.oncomplete();
				}
			};
			img.onerror = function () {
				p.imgdata[index] = p.emptyobj;
				for (i = 0; i < p.totalnum; ++i) {
					if (p.imgdata[i] == null) break;
				}
				if (i == p.totalnum) {
					p.oncomplete();
				}
			};
		}
		if (urls instanceof Array) {
			this.totalnum = urls.length;
			this.imgdata = new Array(this.totalnum);
			for (key in urls) {
				this.getDataURL(urls[key], key);
			}
		} else {
			this.imgdata = new Array(1);
			this.totalnum = 1;
			this.getDataURL(urls, 0);
		}
	}
	var a = new ImageDataURL([
		'https://ss0.bdstatic.com/70cFuHSh_Q1YnxGkpoWK1HF6hhy/it/u=3949025733,3026580881&fm=200&gp=0.jpg',
		'https://ss3.bdstatic.com/70cFv8Sh_Q1YnxGkpoWK1HF6hhy/it/u=85690711,3884201894&fm=26&gp=0.jpg'
	]);
	a.oncomplete = function () {
		var imgs = new Array();
		for (key in this.imgdata) {
			if (this.imgdata[key] == this.emptyobj) {
				imgs.push({
					text: '请上传头像',
					fontSize: 10,
					rowSpan: 3
				});
				continue;
			} //不存在的圖片直接忽略
			imgs.push({
				image: this.imgdata[key],
				fit: [100, 150],
				rowSpan: 3
			}); //在的圖片直接忽略
		}
		pdfMake.fonts = {
			Roboto: {
				normal: 'simfang.ttf',
				bold: 'simfang.ttf',
				italics: 'simfang.ttf',
				bolditalics: 'simfang.ttf'
			}
		};
		console.log(imgs)
		var db = {
			pageSize: 'A4',//默认情况下我们使用portrait或者自定义
			pageOrientation:'landscape',//你可以将它改为横向
			pageMargins: [ 40,20 ],// [左，上，右，下]或[水平，垂直]或只是一个数字为等于边距 
			content: [{
					text: '学生档案',
					fontSize: 22,
					alignment: 'center',
					margin: [ 20, 20 ]
				}, {
					columns: [{
						columns: [{
							alignment: 'center',
							style: 'tableExample',
							width: 335,
							table: {
								headerRows: 1,
								widths: ['*'],
								body: [
									[{text: 'Header 1', style: 'tableHeader'}],
									[{text:'Sample value 1Sample value 3',fillColor:'#ffffff'}],
									[{text:'Sample value 1Sample value 3',fillColor:'#cccccc'}],
									[{text:'Sample value 1Sample value 3',fillColor:'#ffffff'}],
									[{text:'Sample value 1Sample value 3',fillColor:'#cccccc'}],
									[{text:'Sample value 1Sample value 3',fillColor:'#ffffff'}],
									[{text:'Sample value 1Sample value 3',fillColor:'#cccccc'}],
									[{text:'Sample value 1Sample value 3',fillColor:'#ffffff'}],
									[{text:'Sample value 1Sample value 3',fillColor:'#cccccc'}],
									[{text:'Sample value 1Sample value 3',fillColor:'#ffffff'}],
									[{
										image: imgs[0].image,
										alignment: 'right',
										margin: [ 10, 10, 0, 0 ],
										width:315,
										height: 150
									}]
								]
							},
							layout: 'headerLineOnly'
						}, [{
							columns: [{
									image: imgs[0].image,
									alignment: 'right',
									margin: [ 0, 10, 0, 0 ],
									width: 200,
									height: 150
								}, {
									image: imgs[0].image,
									alignment: 'right',
									margin: [ 10, 10, 0, 0 ],
									width: 200,
									height: 150
								}]
							}, {
							columns: [{
								image: imgs[0].image,
								alignment: 'right',
								margin: [ 0, 10, 0, 0 ],
								width: 200,
								height: 150
							}, {
								image: imgs[0].image,
								alignment: 'right',
								margin: [ 10, 10, 0, 0 ],
								width: 200,
								height: 150
							}]
						}]]
					}]
				}
			],
			header: {
				image: 'logo.png',
				width: 50,
				height: 50,
				alignment: 'left',
				margin: [ 10, 10, 0, 0 ]
			},
			footer: {
				image: 'chapter.png',
				width: 150,
				alignment: 'right',
				margin: [0, -100, 10, 10]
			},
			defaultStyle: {
				alignment: 'right',
				columnGap: 20
			}
		}

		$(".open").on("click", function (e) {
			pdfMake.createPdf(db).open();
		})

		$(".download").on("click", function (e) {
			pdfMake.createPdf(db).download();
		})
	}

	//pdfMake.createPdf(db).print();
</script>

</html>
